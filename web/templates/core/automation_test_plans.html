{% extends "base/base.html" %}
{% load static %}

{% block title %}Automation Â· Projects{% endblock %}

{% block head_css %}
    {{ block.super }}
    <link rel="stylesheet" href="{% static 'css/automation.css' %}">
{% endblock %}

{% block content %}
<div class="automation-dashboard" id="automation-app">
    <section class="automation-panel" data-panel="projects" aria-labelledby="headline-projects">
        <div class="panel-header">
            <div>
                <h2 id="headline-projects">Projects</h2>
                <p class="panel-subtitle">Track automation readiness per project with a quick view of modules and scenarios.</p>
            </div>
            <div class="panel-actions">
                <button type="button" class="btn-primary" data-action="open-project-modal">Create Project</button>
            </div>
        </div>
        <div class="card table-card automation-table-card" aria-live="polite">
            <table class="table-modern automation-table" aria-label="Projects overview">
                <thead>
                    <tr>
                        <th scope="col">Name</th>
                        <th scope="col">Modules</th>
                        <th scope="col">Scenarios</th>
                        <th scope="col">Actions</th>
                    </tr>
                </thead>
                <tbody data-role="project-list">
                    {% if initial_plans %}
                        {% for plan in initial_plans %}
                            <tr data-project-id="{{ plan.id }}">
                                <td data-label="Name">
                                    <strong>{{ plan.name|default:"Untitled project" }}</strong>
                                    {% if plan.description %}<div class="table-secondary">{{ plan.description }}</div>{% endif %}
                                </td>
                                <td data-label="Modules">{{ plan.modules_count|default:plan.test_modules|length }}</td>
                                <td data-label="Scenarios">{{ plan.scenarios_count|default:plan.scenarios|length }}</td>
                                <td data-label="Actions">
                                    <div class="table-action-group">
                                        <button type="button" class="action-button" data-action="view-project" data-project-id="{{ plan.id }}">View</button>
                                        <button type="button" class="action-button" data-action="edit-project" data-project-id="{{ plan.id }}">Edit</button>
                                    </div>
                                </td>
                            </tr>
                        {% endfor %}
                    {% else %}
                        <tr>
                            <td colspan="4" class="empty">No projects yet. Create one to kick off your automation cycle.</td>
                        </tr>
                    {% endif %}
                </tbody>
            </table>
        </div>
    </section>

    <div class="automation-modal" data-role="project-modal" hidden>
        <div class="automation-modal__backdrop" data-action="close-project-modal"></div>
        <div class="automation-modal__dialog" role="dialog" aria-modal="true" aria-labelledby="automation-project-modal-title">
            <header class="automation-modal__header">
                <h2 id="automation-project-modal-title">Create Project</h2>
                <button type="button" class="automation-modal__close" data-action="close-project-modal" aria-label="Close project modal">&times;</button>
            </header>
            <form id="project-form" class="automation-form" autocomplete="off">
                <div class="form-alert" data-role="form-errors" hidden></div>
                <fieldset>
                    <legend class="sr-only">Project details</legend>
                    <div class="form-row">
                        <label for="project-name">Name<span aria-hidden="true">*</span></label>
                        <input type="text" id="project-name" name="name" required maxlength="150" placeholder="Billing Automation">
                    </div>
                    <div class="form-row">
                        <label for="project-description">Description</label>
                        <textarea id="project-description" name="description" rows="4" placeholder="Short summary for the team."></textarea>
                    </div>
                </fieldset>
                <div class="form-actions">
                    <button type="submit" class="btn-primary" data-role="project-submit">Save</button>
                    <button type="button" class="btn-secondary" data-action="close-project-modal">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    {{ initial_plans|json_script:"automation-initial-projects" }}
    {{ api_endpoints|json_script:"automation-api-endpoints" }}
</div>
{% endblock %}

{% block body_js %}
    {{ block.super }}
    <script src="{% static 'js/project_module.js' %}"></script>
{% endblock %}
