{% extends 'base/base.html' %}
{% load static %}
{% block title %}Users - List{% endblock %}

{% block head_css %}
  {{ block.super }}
  <link rel="stylesheet" href="{% static 'css/automation.css' %}">
{% endblock %}

{% block content %}
<div class="automation-dashboard user-management-dashboard" id="users-app">
  <section class="automation-panel user-management-panel" data-panel="users" aria-labelledby="users-heading">
    <div class="panel-header">
      <div>
        <h2 id="users-heading">Users</h2>
        <p class="panel-subtitle">Manage platform access, roles, and account status.</p>
      </div>
      <div class="panel-actions">
        {% if perms.accounts.can_add_user %}
        <a class="btn-primary" href="/users/create/" data-testid="user-create-link">Create User</a>
        {% endif %}
      </div>
    </div>

    <div class="card table-card automation-table-card" data-testid="users-card">
      <table class="table-modern automation-table" data-testid="users-table" id="users-table" aria-label="Users list">
        <thead>
          <tr>
            <th scope="col">ID</th>
            <th scope="col">Name</th>
            <th scope="col">Email</th>
            <th scope="col">Role</th>
            <th scope="col">Status</th>
            <th scope="col">Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for u in users %}
          <tr data-user-id="{{ u.id }}">
            <td data-label="ID">{{ u.id }}</td>
            <td data-label="Name">
              <strong><a class="row-link" href="/users/{{ u.id }}/" data-testid="user-name-{{ u.id }}">{{ u.first_name }} {{ u.last_name }}</a></strong>
            </td>
            <td data-label="Email">
              <span class="table-secondary">{{ u.email }}</span>
            </td>
            <td data-label="Role">
              {% with r=u.groups.first %}
                {% if r %}
                  {{ r.name }}
                {% else %}
                  <span class="muted">None</span>
                {% endif %}
              {% endwith %}
            </td>
            <td data-label="Status">{{ u.get_status_display }}</td>
            <td data-label="Actions">
              <div class="table-action-group">
                {% if perms.accounts.can_change_user %}
                <a class="action-button" href="/users/{{ u.id }}/edit/" data-testid="user-edit-{{ u.id }}">Edit</a>
                {% endif %}
                {% if perms.accounts.can_delete_user %}
                <a class="action-button" data-variant="danger" href="/users/{{ u.id }}/delete/" data-testid="user-delete-{{ u.id }}">Delete</a>
                {% endif %}

                {% if not perms.accounts.can_delete_user and not perms.accounts.can_change_user %}
                <label for="">no action available</label>
                {% endif %}
              </div>
            </td>
          </tr>
          {% empty %}
          <tr><td colspan="6" class="empty" data-testid="users-empty">No users found</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    <div class="table-pagination" id="users-pagination" aria-label="Users pagination"></div>
  </section>
</div>
{% endblock %}

{% block body_js %}
  {{ block.super }}
  <script src="{% static 'js/user-management/users.js' %}?v={{ STATIC_VERSION }}"></script>
{% endblock %}
