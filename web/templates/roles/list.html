{% extends 'base/base.html' %}
{% load static %}
{% block title %}Roles - List{% endblock %}

{% block head_css %}
  {{ block.super }}
  <link rel="stylesheet" href="{% static 'css/automation.css' %}">
{% endblock %}

{% block content %}
<div class="automation-dashboard role-management-dashboard" id="roles-app">
  <section class="automation-panel role-management-panel" data-panel="roles" aria-labelledby="roles-heading">
    <div class="panel-header">
      <div>
        <h2 id="roles-heading">Roles</h2>
        <p class="panel-subtitle">Assign modules and fine-grained permissions for every workspace role.</p>
      </div>
      <div class="panel-actions">
        
        {% if perms.accounts.can_add_group %}
        <a class="btn-primary" href="/roles/create/" data-testid="role-create-link">Create Role</a>
        {% endif %}
      </div>
    </div>

    <div class="card table-card automation-table-card" data-testid="roles-card" aria-live="polite">
      <table class="table-modern automation-table" data-testid="roles-table" aria-label="Roles overview" id="roles-table">
        <thead>
          <tr>
            <th scope="col">ID</th>
            <th scope="col">Name</th>
            <th scope="col">Modules</th>
            <th scope="col">Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for role in roles %}
          <tr data-role-id="{{ role.id }}">
            <td data-label="ID">{{ role.id }}</td>
            <td data-label="Name">
              <strong><a class="row-link" href="/roles/{{ role.id }}/" data-testid="role-name-{{ role.id }}">{{ role.name }}</a></strong>
            </td>
            <td data-label="Modules" class="modules-cell">
              {% with mods=role.modules.all %}
                {% if mods|length %}
                  <div class="table-scope-preview">
                    {% for m in mods %}
                      <span class="scope-chip">{{ m.name }}</span>
                    {% endfor %}
                  </div>
                {% else %}
                  <span class="muted">None</span>
                {% endif %}
              {% endwith %}
            </td>
            <td data-label="Actions">
              <div class="table-action-group">
                {% if perms.accounts.can_view_group %}
                <button type="button" class="action-button" data-role-view="{{ role.id }}" data-testid="role-view-{{ role.id }}">View</button>
                {% endif %}
                {% if perms.accounts.can_change_group %}
                <a class="action-button" href="/roles/{{ role.id }}/edit/" data-testid="role-edit-{{ role.id }}">Edit</a>
                {% endif %}
                {% if perms.accounts.can_delete_group %}
                <button type="button" class="action-button" data-variant="danger" data-role-delete="{{ role.id }}" data-testid="role-delete-{{ role.id }}">Delete</button>
                {% endif %}
              </div>
            </td>
          </tr>
          {% empty %}
          <tr class="empty-row"><td colspan="4" class="empty" data-testid="roles-empty">No roles found</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    <div class="table-pagination" id="roles-pagination" aria-label="Roles pagination"></div>
  </section>

  <div class="automation-modal" data-role="role-modal" hidden>
    <div class="automation-modal__backdrop" data-action="close-role-modal"></div>
    <div class="automation-modal__dialog" role="dialog" aria-modal="true" aria-labelledby="role-modal-title">
      <header class="automation-modal__header">
        <h2 id="role-modal-title" data-role="role-modal-title">Role</h2>
        <button type="button" class="automation-modal__close" data-action="close-role-modal" aria-label="Close role dialog">&times;</button>
      </header>
      <div class="automation-modal__body" data-role="role-modal-body"></div>
    </div>
  </div>
</div>
{% endblock %}

{% block body_js %}
  {{ block.super }}
  <script src="{% static 'js/user-management/role.js' %}?v={{ STATIC_VERSION }}"></script>
{% endblock %}
