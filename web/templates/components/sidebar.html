<ul class="sidebar-menu" data-testid="sidebar-menu">
    <li class="menu-item" data-menu="dashboard"><a href="/" data-testid="menu-dashboard">Dashboard</a></li>
    <li class="has-submenu">
                <a href="#" data-testid="menu-user-mgmt">User Management</a>
        <ul class="submenu">
                        <li class="menu-item" data-menu="users"><a href="/users/" data-testid="menu-users">Users</a></li>
                        <li class="menu-item" data-menu="roles"><a href="/roles/" data-testid="menu-roles">Role</a></li>
        </ul>
    </li>
    <li class="menu-item" data-menu="api-tester"><a href="{% url 'api-tester' %}" data-testid="menu-api-tester">API Tester</a></li>
    <li class="has-submenu" data-menu="projects">
        <a href="#" data-testid="menu-projects">Projects</a>
        <ul class="submenu">
            <li class="menu-item" data-menu="projects-test-plans"><a href="{% url 'automation-test-plans' %}" data-testid="menu-projects-plans">Test Plans</a></li>
            <li class="menu-item" data-menu="projects-test-scenarios"><a href="{% url 'automation-test-scenarios' %}" data-testid="menu-projects-scenarios">Test Scenarios</a></li>
            <li class="menu-item" data-menu="projects-test-cases"><a href="{% url 'automation-test-cases' %}" data-testid="menu-projects-cases">Test Case</a></li>
            <li class="menu-item" data-menu="projects-test-plan-maintenance"><a href="{% url 'automation-test-plan-maintenance' %}" data-testid="menu-projects-maintenance">Test Plan Maintenance</a></li>
        </ul>
    </li>
    <li class="has-submenu" data-menu="automation">
        <a href="#" data-testid="menu-automation">Automation</a>
        <ul class="submenu">
            <li class="menu-item" data-menu="automation-overview"><a href="{% url 'automation-overview' %}" data-testid="menu-automation-overview">Overview</a></li>
        </ul>
    </li>
    <li class="has-submenu" data-menu="data-management">
        <a href="#" data-testid="menu-data-management">Data Management</a>
        <ul class="submenu">
            <li class="menu-item" data-menu="data-management-environments"><a href="{% url 'data-management-environments' %}" data-testid="menu-data-environments">API Environment</a></li>
            <li class="menu-item" data-menu="data-management-risks"><a href="{% url 'data-management-risks' %}" data-testid="menu-data-risks">Risk Register</a></li>
            <li class="menu-item" data-menu="data-management-mitigation"><a href="{% url 'data-management-mitigation' %}" data-testid="menu-data-mitigation">Mitigation Plans</a></li>
            <li class="menu-item" data-menu="data-management-test-tools"><a href="{% url 'data-management-test-tools' %}" data-testid="menu-data-test-tools">Test Tools</a></li>
        </ul>
    </li>

</ul>
<script>
document.addEventListener('DOMContentLoaded', function(){
        // submenu toggle
        document.querySelectorAll('.sidebar-menu .has-submenu > a').forEach(function(a){
            a.addEventListener('click', function(e){
                const href = this.getAttribute('href');
                if(!href || href === '#'){
                    e.preventDefault();
                }
                const li = this.parentElement;
                li.classList.toggle('open');
            });
        });
        const path = window.location.pathname.replace(/\/$/, '');
        const currentHash = window.location.hash;
        const items = document.querySelectorAll('.sidebar-menu .menu-item');
        let matched = false;
        items.forEach(function(li){
            const link = li.querySelector('a');
            if(!link) return;
            const rawHref = link.getAttribute('href') || '';
            const parts = rawHref.split('#');
            const hrefPath = parts[0] ? parts[0].replace(/\/$/, '') : '';
            const hrefHash = parts.length > 1 ? '#' + parts[1] : '';
            if(hrefPath && hrefPath === path){
                if(hrefHash && currentHash && hrefHash !== currentHash){
                    return;
                }
                if(!hrefHash && currentHash){
                    return;
                }
                li.classList.add('active');
                matched = true;
                // open & highlight parent submenu if nested
                const parentSub = li.closest('.has-submenu');
                if(parentSub) parentSub.classList.add('open','active');
            }
        });
        if(!matched){
            // default highlight dashboard
            const dash = document.querySelector('[data-menu="dashboard"]');
            if(dash) dash.classList.add('active');
        }
        // click change active
        document.querySelectorAll('.sidebar-menu a[href]').forEach(function(a){
            a.addEventListener('click', function(){
                items.forEach(li=>li.classList.remove('active'));
                const li = this.closest('.menu-item');
                if(li){ li.classList.add('active'); }
            });
        });
});
</script>
