{% extends "base/base.html" %}
{% load static %}

{% block title %}Automation Â· Projects{% endblock %}

{% block head_css %}
    {{ block.super }}
    <link rel="stylesheet" href="{% static 'css/automation.css' %}">
{% endblock %}

{% block content %}
<div class="automation-dashboard" id="automation-app">
    {% if perms.accounts.can_view_project %}<span id="perm-can-view-project" hidden></span>{% endif %}
    {% if perms.accounts.can_change_project %}<span id="perm-can-change-project" hidden></span>{% endif %}
    {% if perms.accounts.can_create_project %}<span id="perm-can-create-project" hidden></span>{% endif %}
    <section class="automation-panel" data-panel="projects" aria-labelledby="headline-projects">
        <div class="panel-header">
            <div>
                <h2 id="headline-projects">Projects</h2>
                <p class="panel-subtitle">Track automation readiness per project with a quick view of modules and scenarios.</p>
            </div>
            <div class="panel-actions">
                {% if perms.accounts.can_create_project %}
                <button type="button" class="btn-primary" data-action="open-project-modal">Create Project</button>
                {% endif %}
            </div>
        </div>
        <div class="card table-card automation-table-card" aria-live="polite">
            <table class="table-modern automation-table" aria-label="Projects overview" id="projects-table">
                <thead>
                    <tr>
                        <th scope="col">Name</th>
                        <th scope="col">Modules</th>
                        <th scope="col">Scenarios</th>
                        <th scope="col">Actions</th>
                    </tr>
                </thead>
                <tbody data-role="project-list">
                    {% if initial_plans %}
                        {% for plan in initial_plans %}
                            <tr data-project-id="{{ plan.id }}">
                                <td data-label="Name">
                                    <strong>{{ plan.name|default:"Untitled project" }}</strong>
                                    {% if plan.description %}<div class="table-secondary">{{ plan.description }}</div>{% endif %}
                                </td>
                                <td data-label="Modules">{{ plan.modules_count|default:plan.test_modules|length }}</td>
                                <td data-label="Scenarios">{{ plan.scenarios_count|default:plan.scenarios|length }}</td>
                                <td data-label="Actions">
                                    <div class="table-action-group">
                                        {% if perms.accounts.can_view_project %}
                                        <button type="button" class="action-button" data-action="view-project" data-project-id="{{ plan.id }}">View</button>
                                        {% endif %}
                                        {% if perms.accounts.can_change_project %}
                                        <button type="button" class="action-button" data-action="edit-project" data-project-id="{{ plan.id }}">Edit</button>
                                        {% endif %}
                                    </div>
                                </td>
                            </tr>
                        {% endfor %}
                    {% else %}
                        <tr>
                            <td colspan="4" class="empty">No projects yet. Create one to kick off your automation cycle.</td>
                        </tr>
                    {% endif %}
                </tbody>
            </table>
        </div>
        <div class="table-pagination" id="projects-pagination" aria-label="Projects pagination"></div>
    </section>

    {% include "automation/projects/project_modal.html" %}

    {{ initial_plans|json_script:"automation-initial-projects" }}
    {{ api_endpoints|json_script:"automation-api-endpoints" }}
</div>
{% endblock %}

{% block body_js %}
    {{ block.super }}
    <script src="{% static 'js/project_module.js' %}?v={{ STATIC_VERSION }}"></script>
{% endblock %}
