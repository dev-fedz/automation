<!-- Add Test Case modal (copied from data management) -->
<div class="automation-modal" data-role="module-add-case-modal" hidden>
    <div class="automation-modal__backdrop" data-action="close-module-add-case-modal"></div>
    <div class="automation-modal__dialog" role="dialog" aria-modal="true" aria-labelledby="module-add-case-modal-title">
        <header class="automation-modal__header">
            <h2 id="module-add-case-modal-title">Add Test Case</h2>
            <button type="button" class="automation-modal__close" data-action="close-module-add-case-modal" aria-label="Close">&times;</button>
        </header>
        <form id="module-add-case-form" class="automation-form" autocomplete="off">
            <fieldset>
                <legend class="sr-only">New test case</legend>
                <input type="hidden" id="module-add-case-scenario-id" name="scenario">
                <div class="form-row">
                    <label for="module-add-case-title">Title<span aria-hidden="true">*</span></label>
                    <input type="text" id="module-add-case-title" name="title" required maxlength="150" placeholder="Case title">
                </div>
                <div class="form-row">
                    <label for="module-add-case-description">Description</label>
                    <textarea id="module-add-case-description" name="description" rows="3"></textarea>
                </div>

                <div class="form-row">
                    <label for="module-add-case-steps">Steps (one per line)</label>
                    <textarea id="module-add-case-steps" name="steps" rows="4" placeholder="Step 1\nStep 2"></textarea>
                </div>
                <div class="form-row">
                    <label for="module-add-case-expected">Expected results (key: value per line)</label>
                    <textarea id="module-add-case-expected" name="expected" rows="4" placeholder="response.status_code: 200
response.json.plan: premium
# Optional note"></textarea>
                </div>
                <div class="form-row">
                    <label for="module-add-case-precondition">Preconditions</label>
                    <textarea id="module-add-case-precondition" name="precondition" rows="2" placeholder="Any setup or state required before executing this test."></textarea>
                </div>
                <div class="form-row">
                    <label for="module-add-case-requirements">Requirements</label>
                    <textarea id="module-add-case-requirements" name="requirements" rows="2" placeholder="Linked requirement IDs or description."></textarea>
                </div>
                <div class="form-row">
                    <label for="module-add-case-priority">Priority</label>
                    <input type="text" id="module-add-case-priority" name="priority" placeholder="P1">
                </div>
                <div class="form-row dependency-toggle">
                    <label class="dependency-toggle__label" for="module-add-case-response-encrypted">
                        <input type="checkbox" id="module-add-case-response-encrypted" name="is_response_encrypted">
                        <span>Response body requires post-request decryption</span>
                    </label>
                    <small class="form-hint">Expected results will be matched against data exposed as "Decrypted Data" by the post-request script.</small>
                </div>
                <div class="form-row dependency-toggle">
                    <label class="dependency-toggle__label" for="module-add-case-requires-dependency">
                        <input type="checkbox" id="module-add-case-requires-dependency" name="requires_dependency">
                        <span>Require dependency test case before running</span>
                    </label>
                </div>
                <div class="form-row dependency-settings" data-role="dependency-fields" hidden>
                    <label for="module-add-case-dependency-id">Dependency test case</label>
                    <select id="module-add-case-dependency-id" name="test_case_dependency" disabled>
                        <option value="">(no dependency)</option>
                    </select>
                    <small class="form-hint">Only cases within the selected scenario are available.</small>
                </div>
                <div class="form-row dependency-settings" data-role="dependency-fields" hidden>
                    <label for="module-add-case-dependency-key">Required dependency response key</label>
                    <input type="text" id="module-add-case-dependency-key" name="dependency_response_key" placeholder="response.data.token" disabled>
                    <small class="form-hint">Specify the JSON key that must exist in the dependency response.</small>
                </div>
                <input type="hidden" id="module-add-case-related-api-request-id" name="related_api_request" value="">
                <div class="form-row">
                    <button type="button" id="module-open-api-explorer" class="btn-secondary">Choose Related API Request</button>
                    <small id="module-related-api-request-label" class="form-hint">No API request selected</small>
                </div>
            </fieldset>
            <div class="form-actions">
                <button type="submit" class="btn-primary">Save Test Case</button>
            </div>

        </form>

        {% include "automation/testcases/testcase_comments_section.html" %}
    </div>

</div>
